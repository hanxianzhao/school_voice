<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>小小班 · 污水处理厂互动流程图</title>
  <meta name="description" content="面向小朋友的污水处理流程互动演示：从产生、管道输送、处理到排放。" />
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <header class="app-header">
    <h1>💧 小小班 · 污水变清流之旅 💧</h1>
    <p class="subtitle">点一点，看污水是怎么变干净的！</p>
  </header>

  <main class="app-main">
    <aside class="sidebar">
      <div class="controls">
        <button id="toggleFlow" class="btn primary">🌊 开始流动</button>
        <button id="replayFlow" class="btn">🔄 重播</button>
      </div>
      <div class="legend">
        <h3>图例</h3>
        <div class="legend-row"><span class="chip chip-water"></span> 水流方向</div>
        <div class="legend-row"><span class="chip chip-node"></span> 点我试试</div>
        <div class="legend-row"><span class="chip chip-sludge"></span> 污泥路线</div>
      </div>
      <div class="info-panel" id="infoPanel">
        <h3 id="infoTitle">欢迎来到污水厂！</h3>
        <p id="infoText">这里是处理脏水的地方。点击图上的小房子或池子，看看它们是做什么的吧！</p>
      </div>
    </aside>

    <section class="diagram">
      <!-- 新的布局：1200x800 -->
      <svg id="flowSvg" viewBox="0 0 1200 800" role="img" aria-label="污水处理流程图">
        <defs>
          <!-- 箭头 -->
          <marker id="arrow" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6" orient="auto">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#039be5" />
          </marker>
          <marker id="arrow-sludge" viewBox="0 0 10 10" refX="8" refY="5" markerWidth="6" markerHeight="6"
            orient="auto">
            <path d="M 0 0 L 10 5 L 0 10 z" fill="#795548" />
          </marker>

          <!-- 通用脸部 (Kawaii Face) -->
          <symbol id="face-happy" viewBox="0 0 20 10">
            <circle cx="4" cy="4" r="2" fill="#333" />
            <circle cx="16" cy="4" r="2" fill="#333" />
            <path d="M6 7 Q10 10 14 7" fill="none" stroke="#333" stroke-width="1.5" stroke-linecap="round" />
          </symbol>

          <!-- 图标定义 -->
          <symbol id="icon-house" viewBox="0 0 64 64">
            <path d="M8 32 L32 10 L56 32 V54 H8 V32 Z" class="icon-fill" />
            <path d="M8 32 L32 10 L56 32" class="icon-path" />
            <rect x="24" y="36" width="16" height="18" class="icon-path" fill="#fff" />
            <!-- 烟囱 -->
            <rect x="42" y="16" width="8" height="12" fill="#90a4ae" />
          </symbol>

          <symbol id="icon-pipe" viewBox="0 0 64 64">
            <rect x="4" y="20" width="56" height="24" rx="12" class="icon-fill" />
            <path d="M10 32 H54" class="icon-path" stroke-dasharray="4 4" />
          </symbol>
          <symbol id="icon-pump" viewBox="0 0 64 64">
            <circle cx="32" cy="32" r="22" class="icon-fill" />
            <path d="M32 10 V54 M10 32 H54" class="icon-path" />
            <circle cx="32" cy="32" r="18" fill="#fff" opacity="0.3" />
            <use href="#face-happy" x="22" y="28" width="20" height="10" />
          </symbol>

          <symbol id="icon-grid" viewBox="0 0 64 64">
            <rect x="12" y="12" width="40" height="40" rx="4" class="icon-fill" />
            <path d="M20 12 V52 M32 12 V52 M44 12 V52" class="icon-path" />
            <use href="#face-happy" x="22" y="20" width="20" height="10" />
          </symbol>

          <symbol id="icon-tank" viewBox="0 0 64 64">
            <path d="M4 20 H60 V44 C60 54 50 60 32 60 C14 60 4 54 4 44 V20 Z" class="icon-fill" />
            <path d="M4 20 H60" class="icon-path" />
            <use href="#face-happy" x="22" y="35" width="20" height="10" />
          </symbol>

          <symbol id="icon-bubbles" viewBox="0 0 64 64">
            <path d="M4 20 H60 V44 C60 54 50 60 32 60 C14 60 4 54 4 44 V20 Z" class="icon-fill" />
            <circle cx="16" cy="36" r="4" fill="#fff" opacity="0.8" />
            <circle cx="32" cy="42" r="6" fill="#fff" opacity="0.8" />
            <circle cx="48" cy="34" r="4" fill="#fff" opacity="0.8" />
            <use href="#face-happy" x="22" y="25" width="20" height="10" />
          </symbol>

          <symbol id="icon-disinfect" viewBox="0 0 64 64">
            <rect x="10" y="16" width="44" height="36" rx="8" class="icon-fill" />
            <path d="M32 22 V46 M20 34 H44" class="icon-path" stroke="#fff" stroke-width="4" />
            <use href="#face-happy" x="22" y="20" width="20" height="10" />
          </symbol>

          <symbol id="icon-river" viewBox="0 0 64 64">
            <path d="M4 32 Q16 16 32 32 T60 32" class="icon-path" />
            <path d="M4 42 Q16 26 32 42 T60 42" class="icon-path" />
            <circle cx="50" cy="20" r="2" fill="#ff9800" />
            <!-- 小鱼眼 -->
            <path d="M44 20 L54 20 L54 26 Z" fill="#ff9800" />
            <!-- 小鱼 -->
          </symbol>

          <symbol id="icon-sludge" viewBox="0 0 64 64">
            <path d="M12 48 Q32 32 52 48 V56 H12 Z" fill="#8d6e63" />
            <rect x="16" y="20" width="32" height="28" class="icon-path" fill="#d7ccc8" />
            <use href="#face-happy" x="22" y="30" width="20" height="10" />
          </symbol>
        </defs>

        <!-- 背景装饰：天空与草地 -->
        <!-- 太阳 -->
        <g transform="translate(1050, 80)">
          <circle r="40" fill="#ffd54f" />
          <circle r="40" fill="none" stroke="#ffb300" stroke-width="4" stroke-dasharray="10 10" opacity="0.5">
            <animateTransform attributeName="transform" type="rotate" from="0" to="360" dur="20s"
              repeatCount="indefinite" />
          </circle>
          <!-- 太阳笑脸 -->
          <circle cx="-12" cy="-5" r="4" fill="#333" />
          <circle cx="12" cy="-5" r="4" fill="#333" />
          <path d="M-10 10 Q0 20 10 10" fill="none" stroke="#333" stroke-width="3" stroke-linecap="round" />
        </g>

        <!-- 云朵 -->
        <g opacity="0.8">
          <path d="M100 100 Q120 80 140 100 T180 100 T200 120 H100 Z" fill="#fff" />
          <animateTransform attributeName="transform" type="translate" values="0 0; 20 0; 0 0" dur="8s"
            repeatCount="indefinite" />
        </g>
        <g opacity="0.6" transform="translate(400, -20)">
          <path d="M100 100 Q120 80 140 100 T180 100 T200 120 H100 Z" fill="#fff" />
          <animateTransform attributeName="transform" type="translate" values="0 0; -30 0; 0 0" dur="12s"
            repeatCount="indefinite" />
        </g>

        <!-- 区域背景框 (更圆润，颜色更柔和) -->
        <rect x="20" y="20" width="1160" height="180" fill="rgba(255,255,255,0.4)" rx="30" stroke="#b3e5fc"
          stroke-width="2" stroke-dasharray="10 10" />
        <text x="80" y="60" fill="#0277bd" font-size="24" font-weight="bold"
          style="font-family: 'Comic Sans MS', cursive;">🏡 我们的家 (来源)</text>

        <rect x="20" y="220" width="1160" height="360" fill="rgba(255,255,255,0.6)" rx="30" stroke="#81d4fa"
          stroke-width="2" stroke-dasharray="10 10" />
        <text x="80" y="260" fill="#0277bd" font-size="24" font-weight="bold"
          style="font-family: 'Comic Sans MS', cursive;">⚙️ 污水变身工厂 (处理)</text>

        <rect x="20" y="600" width="1160" height="180" fill="rgba(255,255,255,0.4)" rx="30" stroke="#4fc3f7"
          stroke-width="2" stroke-dasharray="10 10" />
        <text x="80" y="640" fill="#0277bd" font-size="24" font-weight="bold"
          style="font-family: 'Comic Sans MS', cursive;">🌊 回归大自然 (排放)</text>


        <!-- 连线 (Pipes) -->
        <!-- 1. Source -> Pipe -> Pump -->
        <path d="M180 140 L180 280 L240 280" class="pipe-bg" />
        <path d="M180 140 L180 280 L240 280" class="flow-line" />

        <!-- 2. Pump -> Grid -->
        <path d="M340 280 L400 280" class="pipe-bg" />
        <path d="M340 280 L400 280" class="flow-line" />

        <!-- 3. Grid -> Primary -->
        <path d="M500 280 L560 280" class="pipe-bg" />
        <path d="M500 280 L560 280" class="flow-line" />

        <!-- 4. Primary -> Aeration -->
        <path d="M660 280 L720 280" class="pipe-bg" />
        <path d="M660 280 L720 280" class="flow-line" />

        <!-- 5. Aeration -> Secondary -->
        <path d="M820 280 L880 280" class="pipe-bg" />
        <path d="M820 280 L880 280" class="flow-line" />

        <!-- 6. Secondary -> Disinfect -->
        <path d="M980 280 L1040 280 L1040 380 L980 380" class="pipe-bg" />
        <path d="M980 280 L1040 280 L1040 380 L980 380" class="flow-line" />

        <!-- 7. Disinfect -> River -->
        <path d="M880 380 L500 380 L500 640" class="pipe-bg" />
        <path d="M880 380 L500 380 L500 640" class="flow-line" marker-end="url(#arrow)" />

        <!-- 8. Sludge: Secondary -> Sludge Tank -->
        <path d="M930 330 L930 640" class="pipe-bg" style="stroke: #d7ccc8;" />
        <path d="M930 330 L930 640" class="sludge-line" marker-end="url(#arrow-sludge)" />


        <!-- 节点 (Nodes) -->

        <!-- Source -->
        <g class="node-group step" id="source" transform="translate(100, 60)" data-title="污水从哪里来？"
          data-text="在家里洗澡、洗衣服、冲厕所，都会产生脏脏的污水哦。">
          <rect x="0" y="0" width="160" height="80" rx="40" class="node-bg" />
          <use href="#icon-house" x="20" y="8" width="64" height="64" />
          <text x="100" y="45" class="node-title">家 / 学校</text>
        </g>

        <!-- Pump -->
        <g class="node-group step" id="pump" transform="translate(240, 240)" data-title="提升泵站"
          data-text="泵站像大力士，把低处的污水抽到高处，让它能流进处理厂。">
          <rect x="0" y="0" width="100" height="80" rx="20" class="node-bg" />
          <use href="#icon-pump" x="18" y="8" width="64" height="64" />
          <text x="50" y="95" class="node-title">提升泵站</text>
        </g>

        <!-- Grid -->
        <g class="node-group step" id="pretreat" transform="translate(400, 240)" data-title="格栅与沉砂"
          data-text="像筛子一样，把大垃圾和沙石头拦住，保护后面的设备。">
          <rect x="0" y="0" width="100" height="80" rx="20" class="node-bg" />
          <use href="#icon-grid" x="18" y="8" width="64" height="64" />
          <text x="50" y="95" class="node-title">格栅沉砂</text>
        </g>

        <!-- Primary -->
        <g class="node-group step" id="primary" transform="translate(560, 240)" data-title="初沉池"
          data-text="让水静静地休息一会儿，重一点的脏东西就会沉到水底。">
          <rect x="0" y="0" width="100" height="80" rx="20" class="node-bg" />
          <use href="#icon-tank" x="18" y="8" width="64" height="64" />
          <text x="50" y="95" class="node-title">初沉池</text>
        </g>

        <!-- Aeration -->
        <g class="node-group step" id="aeration" transform="translate(720, 240)" data-title="曝气池"
          data-text="这里有很多微生物宝宝，给它们吹吹氧气，它们就会吃掉水里的脏东西！">
          <rect x="0" y="0" width="100" height="80" rx="20" class="node-bg" />
          <use href="#icon-bubbles" x="18" y="8" width="64" height="64" />
          <text x="50" y="95" class="node-title">曝气池</text>
        </g>

        <!-- Secondary -->
        <g class="node-group step" id="secondary" transform="translate(880, 240)" data-title="二沉池"
          data-text="微生物吃饱了，在这里和水分开。干净水在上面，泥巴在下面。">
          <rect x="0" y="0" width="100" height="80" rx="20" class="node-bg" />
          <use href="#icon-tank" x="18" y="8" width="64" height="64" />
          <text x="50" y="95" class="node-title">二沉池</text>
        </g>

        <!-- Disinfect -->
        <g class="node-group step" id="disinfect" transform="translate(880, 340)" data-title="消毒池"
          data-text="加一点消毒水，把剩下的坏细菌消灭掉，水就变干净啦！">
          <rect x="0" y="0" width="100" height="80" rx="20" class="node-bg" />
          <use href="#icon-disinfect" x="18" y="8" width="64" height="64" />
          <text x="50" y="95" class="node-title">消毒池</text>
        </g>

        <!-- River -->
        <g class="node-group step" id="outfall" transform="translate(420, 640)" data-title="清水排放"
          data-text="处理好的干净水，终于可以回到小河里，鱼儿们好开心！">
          <rect x="0" y="0" width="160" height="80" rx="40" class="node-bg" style="stroke: #4caf50;" />
          <use href="#icon-river" x="48" y="8" width="64" height="64" />
          <text x="80" y="45" class="node-title" style="fill: #2e7d32;">回到小河</text>
        </g>

        <!-- Sludge -->
        <g class="node-group step" id="sludge" transform="translate(850, 640)" data-title="污泥处理"
          data-text="沉下来的泥巴被挤干水分，变成泥饼，运走做肥料或者填埋。">
          <rect x="0" y="0" width="160" height="80" rx="40" class="node-bg sludge-node" />
          <use href="#icon-sludge" x="48" y="8" width="64" height="64" />
          <text x="80" y="45" class="node-title" style="fill: #5d4037;">污泥处理</text>
        </g>

      </svg>
    </section>
  </main>

  <script src="./app.js"></script>
</body>

</html>